<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¯ BOMBA BET</title>

<script src="https://cdn.tailwindcss.com"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<style>
body{background:#0a0a0f;color:#e4e4e7;font-family:Inter,sans-serif}
.glass{background:rgba(255,255,255,.04);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.08)}
.loader{animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div id="root"></div>

<script>
// ================= FIREBASE =================
firebase.initializeApp({
  apiKey: "AIzaSyAzXGyOUDeok9zHZ3Lrqplb9I4u2xxGsPY",
  authDomain: "bombabet26.firebaseapp.com",
  databaseURL: "https://bombabet26-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "bombabet26"
});

const auth = firebase.auth();
const db   = firebase.database();

// ================= API =================
const FOOTBALL_API_KEY = "e6b4654b35e54995aeb2834ae3f81bcb";
const PROXY = url => `https://corsproxy.io/?${encodeURIComponent(url)}`;

// ================= STATE =================
let state = {
  user:null,
  loading:false,
  selectedLeague:135,
  footballMatches:[]
};

// ================= AUTH =================
auth.onAuthStateChanged(user=>{
  state.user = user;
  render();
  if(user){
    fetchFootballMatches(); // âœ… giÃ  presente e funzionante
  }
});

function login(){
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
}
function logout(){
  auth.signOut();
}

// ================= UTILS =================
function getDatePlusDays(d){
  const x=new Date();
  x.setDate(x.getDate()+d);
  return x.toISOString().split("T")[0];
}

// ================= FETCH (RIPARATO) =================
async function fetchFootballMatches(){
  state.loading=true;
  render();

  const today = new Date().toISOString().split("T")[0];

  const url = `
https://v3.football.api-sports.io/fixtures
?league=${state.selectedLeague}
&season=2025
&from=${today}
&to=${getDatePlusDays(7)}
`.replace(/\s+/g,'');

  try{
    const res = await fetch(PROXY(url),{
      headers:{'x-apisports-key':FOOTBALL_API_KEY}
    });

    const data = await res.json();
    console.log("Fixtures ricevute:", data.response?.length);

    state.footballMatches = (data.response || [])
      .filter(m =>
        ['NS','TBD','LIVE'].includes(m.fixture.status.short)
      )
      .sort((a,b) =>
        new Date(a.fixture.date) - new Date(b.fixture.date)
      )
      .slice(0,20);

  }catch(e){
    console.error("API ERROR",e);
    state.footballMatches=[];
  }

  state.loading=false;
  render();
}

// ================= RENDER =================
function render(){
  const root=document.getElementById("root");

  if(!state.user){
    root.innerHTML=`
      <div class="min-h-screen flex items-center justify-center">
        <button onclick="login()" class="glass px-6 py-4 rounded-xl font-bold">
          ğŸ” Login con Google
        </button>
      </div>`;
    return;
  }

  root.innerHTML=`
  <div class="max-w-lg mx-auto p-3 space-y-3">

    <div class="flex justify-between items-center">
      <h1 class="font-black text-xl">âš½ BOMBA BET</h1>
      <button onclick="logout()">ğŸšª</button>
    </div>

    <button onclick="fetchFootballMatches()"
      class="glass px-3 py-2 rounded-lg w-full">
      ${state.loading?'â³ Caricamento':'ğŸ”„ Ricarica partite'}
    </button>

    <div class="space-y-2">
      ${
        state.footballMatches.length===0 && !state.loading
        ? `<div class="glass p-4 text-center text-gray-400">
            Nessuna partita trovata
           </div>`
        : ''
      }

      ${
        state.footballMatches.map(m=>{
          const d=new Date(m.fixture.date);
          return `
          <div class="glass p-3 rounded-lg">
            <p class="font-bold text-sm">
              ${m.teams.home.name} vs ${m.teams.away.name}
            </p>
            <p class="text-xs text-gray-400">
              ${d.toLocaleDateString()} 
              ${d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}
            </p>
          </div>`;
        }).join('')
      }
    </div>
  </div>`;
}
</script>
</body>
</html>
