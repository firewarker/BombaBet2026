<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ ULTRA BET V5 | Football ‚Ä¢ NBA ‚Ä¢ Tennis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        body { background: #0a0a0f; color: #e4e4e7; }
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.08); }
        .glow { box-shadow: 0 0 40px rgba(0,212,170,0.2); }
        .glow-orange { box-shadow: 0 0 40px rgba(249,115,22,0.2); }
        .glow-purple { box-shadow: 0 0 40px rgba(168,85,247,0.2); }
        .gradient-text { background: linear-gradient(135deg, #00d4aa, #0ea5e9); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gradient-orange { background: linear-gradient(135deg, #f97316, #eab308); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gradient-purple { background: linear-gradient(135deg, #a855f7, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .loader { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .hot-badge { animation: hotPulse 1.5s infinite; }
        @keyframes hotPulse { 0%, 100% { box-shadow: 0 0 5px #f59e0b; } 50% { box-shadow: 0 0 25px #f59e0b; } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(15px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .tab-football { background: linear-gradient(135deg, #10b981, #0ea5e9); }
        .tab-nba { background: linear-gradient(135deg, #f97316, #eab308); }
        .tab-tennis { background: linear-gradient(135deg, #a855f7, #ec4899); }
        input, select { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #00d4aa; border-radius: 2px; }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>

    <script>
        // ============================================================
        // üéØ ULTRA BET V5 - MULTI-SPORT COMPLETE
        // ============================================================

        const PROXY = (url) => `https://corsproxy.io/?${encodeURIComponent(url)}`;
        const DB_KEY = 'ultraBetV5History';

        // ============================================================
        // ‚öΩ FOOTBALL DATA
        // ============================================================
        
        const FOOTBALL_LEAGUES = {
            SA: { name: "Serie A", flag: "üáÆüáπ", avgCorners: 10.3, avgCards: 4.2 },
            PL: { name: "Premier League", flag: "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø", avgCorners: 10.8, avgCards: 3.6 },
            PD: { name: "La Liga", flag: "üá™üá∏", avgCorners: 9.9, avgCards: 4.8 },
            BL1: { name: "Bundesliga", flag: "üá©üá™", avgCorners: 10.6, avgCards: 3.5 },
            CL: { name: "Champions League", flag: "üèÜ", avgCorners: 10.8, avgCards: 3.2 }
        };

        const TEAM_STATS = {
            'Juventus': { corners: 5.8, cornersAg: 4.2, cards: 2.1, cardsAg: 1.8 },
            'Inter': { corners: 6.2, cornersAg: 3.8, cards: 1.9, cardsAg: 2.0 },
            'Milan': { corners: 5.5, cornersAg: 4.5, cards: 2.3, cardsAg: 1.9 },
            'Napoli': { corners: 5.9, cornersAg: 4.0, cards: 2.0, cardsAg: 2.1 },
            'Roma': { corners: 5.3, cornersAg: 4.8, cards: 2.4, cardsAg: 2.0 },
            'Lazio': { corners: 5.4, cornersAg: 4.6, cards: 2.2, cardsAg: 2.2 },
            'Atalanta': { corners: 6.0, cornersAg: 4.1, cards: 2.1, cardsAg: 1.8 },
            'Fiorentina': { corners: 5.2, cornersAg: 4.9, cards: 2.3, cardsAg: 2.1 },
            'Bologna': { corners: 5.1, cornersAg: 5.0, cards: 2.0, cardsAg: 2.3 },
            'Torino': { corners: 4.8, cornersAg: 5.2, cards: 2.4, cardsAg: 2.0 },
            'Manchester City': { corners: 7.2, cornersAg: 3.1, cards: 1.5, cardsAg: 1.8 },
            'Arsenal': { corners: 6.5, cornersAg: 3.8, cards: 1.7, cardsAg: 1.9 },
            'Liverpool': { corners: 6.8, cornersAg: 3.5, cards: 1.6, cardsAg: 2.0 },
            'Chelsea': { corners: 5.8, cornersAg: 4.2, cards: 1.9, cardsAg: 1.8 },
            'Manchester United': { corners: 5.5, cornersAg: 4.8, cards: 2.0, cardsAg: 1.7 },
            'Tottenham': { corners: 5.9, cornersAg: 4.5, cards: 1.8, cardsAg: 2.1 },
            'Newcastle': { corners: 5.6, cornersAg: 4.6, cards: 1.9, cardsAg: 1.9 },
            'Real Madrid': { corners: 6.8, cornersAg: 3.2, cards: 2.0, cardsAg: 2.4 },
            'Barcelona': { corners: 7.0, cornersAg: 3.0, cards: 1.8, cardsAg: 2.5 },
            'Atletico Madrid': { corners: 5.2, cornersAg: 4.0, cards: 2.8, cardsAg: 2.2 },
            'Bayern Munich': { corners: 7.5, cornersAg: 2.8, cards: 1.4, cardsAg: 1.9 },
            'Borussia Dortmund': { corners: 6.2, cornersAg: 4.0, cards: 1.7, cardsAg: 1.7 },
            'PSG': { corners: 7.8, cornersAg: 2.5, cards: 1.6, cardsAg: 2.2 }
        };

        // ============================================================
        // üèÄ NBA DATA - TEAMS & PLAYERS
        // ============================================================

        const NBA_TEAMS = {
            'Lakers': { avgPts: 115.2, avgAllow: 113.8, pace: 100.5, logo: 'üíú' },
            'Celtics': { avgPts: 120.5, avgAllow: 108.2, pace: 99.8, logo: '‚òòÔ∏è' },
            'Warriors': { avgPts: 112.8, avgAllow: 110.5, pace: 101.2, logo: 'üíõ' },
            'Nuggets': { avgPts: 116.5, avgAllow: 109.8, pace: 98.5, logo: '‚õèÔ∏è' },
            'Bucks': { avgPts: 118.2, avgAllow: 112.5, pace: 99.2, logo: 'ü¶å' },
            'Heat': { avgPts: 110.2, avgAllow: 108.5, pace: 96.8, logo: 'üî•' },
            'Mavericks': { avgPts: 117.8, avgAllow: 114.2, pace: 100.8, logo: 'üê¥' },
            'Suns': { avgPts: 113.5, avgAllow: 112.8, pace: 99.5, logo: '‚òÄÔ∏è' },
            'Knicks': { avgPts: 112.5, avgAllow: 110.2, pace: 97.5, logo: 'üóΩ' },
            'Clippers': { avgPts: 111.8, avgAllow: 109.5, pace: 98.2, logo: '‚õµ' }
        };

        // üåü NBA PLAYERS DATABASE - Stats reali 2024/25
        const NBA_PLAYERS = {
            // Lakers
            'LeBron James': { team: 'Lakers', ppg: 25.8, rpg: 7.5, apg: 8.2, mpg: 35.2, fg: 52.1 },
            'Anthony Davis': { team: 'Lakers', ppg: 27.2, rpg: 12.1, apg: 3.5, mpg: 36.5, fg: 55.8 },
            'Austin Reaves': { team: 'Lakers', ppg: 18.5, rpg: 4.2, apg: 5.8, mpg: 33.1, fg: 45.2 },
            // Celtics
            'Jayson Tatum': { team: 'Celtics', ppg: 28.5, rpg: 8.8, apg: 5.2, mpg: 36.8, fg: 47.5 },
            'Jaylen Brown': { team: 'Celtics', ppg: 24.2, rpg: 5.8, apg: 3.8, mpg: 34.5, fg: 49.2 },
            'Derrick White': { team: 'Celtics', ppg: 16.8, rpg: 4.2, apg: 5.1, mpg: 32.5, fg: 46.8 },
            // Warriors
            'Stephen Curry': { team: 'Warriors', ppg: 26.8, rpg: 4.5, apg: 6.2, mpg: 32.8, fg: 45.5 },
            'Draymond Green': { team: 'Warriors', ppg: 8.5, rpg: 6.2, apg: 5.8, mpg: 28.5, fg: 42.1 },
            // Nuggets
            'Nikola Jokic': { team: 'Nuggets', ppg: 29.5, rpg: 13.2, apg: 10.8, mpg: 37.2, fg: 58.5 },
            'Jamal Murray': { team: 'Nuggets', ppg: 21.5, rpg: 4.2, apg: 6.5, mpg: 33.5, fg: 46.2 },
            // Bucks
            'Giannis Antetokounmpo': { team: 'Bucks', ppg: 31.2, rpg: 11.8, apg: 6.5, mpg: 35.8, fg: 61.2 },
            'Damian Lillard': { team: 'Bucks', ppg: 25.5, rpg: 4.5, apg: 7.2, mpg: 35.2, fg: 43.8 },
            // Heat
            'Jimmy Butler': { team: 'Heat', ppg: 22.5, rpg: 5.8, apg: 5.2, mpg: 34.2, fg: 50.5 },
            'Bam Adebayo': { team: 'Heat', ppg: 18.8, rpg: 10.5, apg: 4.8, mpg: 34.8, fg: 52.1 },
            // Mavericks
            'Luka Doncic': { team: 'Mavericks', ppg: 33.5, rpg: 9.2, apg: 9.8, mpg: 37.5, fg: 48.2 },
            'Kyrie Irving': { team: 'Mavericks', ppg: 25.8, rpg: 5.1, apg: 5.5, mpg: 35.5, fg: 49.5 },
            // Suns
            'Kevin Durant': { team: 'Suns', ppg: 27.8, rpg: 6.5, apg: 5.2, mpg: 36.2, fg: 52.8 },
            'Devin Booker': { team: 'Suns', ppg: 27.2, rpg: 4.8, apg: 6.8, mpg: 35.8, fg: 49.2 },
            // Knicks
            'Jalen Brunson': { team: 'Knicks', ppg: 28.2, rpg: 3.8, apg: 7.5, mpg: 35.5, fg: 48.5 },
            'Karl-Anthony Towns': { team: 'Knicks', ppg: 25.5, rpg: 13.8, apg: 3.2, mpg: 34.2, fg: 54.2 }
        };

        // Partite NBA di esempio (realistiche)
        const NBA_GAMES = [
            { id: 1, home: 'Lakers', away: 'Celtics', date: '2026-01-10T02:30:00Z', players: ['LeBron James', 'Anthony Davis', 'Jayson Tatum', 'Jaylen Brown'] },
            { id: 2, home: 'Warriors', away: 'Nuggets', date: '2026-01-10T03:00:00Z', players: ['Stephen Curry', 'Nikola Jokic', 'Jamal Murray'] },
            { id: 3, home: 'Bucks', away: 'Heat', date: '2026-01-11T01:00:00Z', players: ['Giannis Antetokounmpo', 'Damian Lillard', 'Jimmy Butler', 'Bam Adebayo'] },
            { id: 4, home: 'Mavericks', away: 'Suns', date: '2026-01-11T02:30:00Z', players: ['Luka Doncic', 'Kyrie Irving', 'Kevin Durant', 'Devin Booker'] },
            { id: 5, home: 'Knicks', away: 'Clippers', date: '2026-01-12T00:30:00Z', players: ['Jalen Brunson', 'Karl-Anthony Towns'] },
            { id: 6, home: 'Celtics', away: 'Bucks', date: '2026-01-12T02:00:00Z', players: ['Jayson Tatum', 'Jaylen Brown', 'Giannis Antetokounmpo', 'Damian Lillard'] },
            { id: 7, home: 'Nuggets', away: 'Lakers', date: '2026-01-13T03:00:00Z', players: ['Nikola Jokic', 'Jamal Murray', 'LeBron James', 'Anthony Davis'] },
            { id: 8, home: 'Heat', away: 'Mavericks', date: '2026-01-13T01:30:00Z', players: ['Jimmy Butler', 'Bam Adebayo', 'Luka Doncic', 'Kyrie Irving'] }
        ];

        // ============================================================
        // üéæ TENNIS DATA
        // ============================================================

        const TENNIS_PLAYERS = {
            'Jannik Sinner': { rank: 1, winRate: 82, avgGames: 21.2, surface: { hard: 85, clay: 78, grass: 75 } },
            'Novak Djokovic': { rank: 2, winRate: 78, avgGames: 22.0, surface: { hard: 80, clay: 82, grass: 85 } },
            'Carlos Alcaraz': { rank: 3, winRate: 76, avgGames: 22.5, surface: { hard: 78, clay: 80, grass: 82 } },
            'Daniil Medvedev': { rank: 4, winRate: 70, avgGames: 23.0, surface: { hard: 75, clay: 60, grass: 68 } },
            'Alexander Zverev': { rank: 5, winRate: 68, avgGames: 23.2, surface: { hard: 70, clay: 72, grass: 65 } },
            'Andrey Rublev': { rank: 6, winRate: 65, avgGames: 22.8, surface: { hard: 68, clay: 65, grass: 60 } },
            'Holger Rune': { rank: 7, winRate: 62, avgGames: 23.5, surface: { hard: 64, clay: 65, grass: 58 } },
            'Taylor Fritz': { rank: 8, winRate: 64, avgGames: 22.5, surface: { hard: 68, clay: 55, grass: 65 } },
            'Iga Swiatek': { rank: 1, winRate: 85, avgGames: 18.5, surface: { hard: 82, clay: 92, grass: 70 }, tour: 'WTA' },
            'Aryna Sabalenka': { rank: 2, winRate: 75, avgGames: 20.0, surface: { hard: 80, clay: 68, grass: 72 }, tour: 'WTA' },
            'Coco Gauff': { rank: 3, winRate: 70, avgGames: 21.0, surface: { hard: 72, clay: 68, grass: 65 }, tour: 'WTA' },
            'Elena Rybakina': { rank: 4, winRate: 68, avgGames: 20.5, surface: { hard: 70, clay: 60, grass: 78 }, tour: 'WTA' }
        };

        // Partite Tennis di esempio
        const TENNIS_MATCHES = [
            { id: 1, player1: 'Jannik Sinner', player2: 'Carlos Alcaraz', tournament: 'Australian Open', round: 'Semifinale', surface: 'hard', date: '2026-01-10T09:00:00Z' },
            { id: 2, player1: 'Novak Djokovic', player2: 'Daniil Medvedev', tournament: 'Australian Open', round: 'Semifinale', surface: 'hard', date: '2026-01-10T04:00:00Z' },
            { id: 3, player1: 'Alexander Zverev', player2: 'Taylor Fritz', tournament: 'Australian Open', round: 'Quarti', surface: 'hard', date: '2026-01-11T06:00:00Z' },
            { id: 4, player1: 'Andrey Rublev', player2: 'Holger Rune', tournament: 'Australian Open', round: 'Quarti', surface: 'hard', date: '2026-01-11T08:30:00Z' },
            { id: 5, player1: 'Iga Swiatek', player2: 'Aryna Sabalenka', tournament: 'Australian Open', round: 'Finale', surface: 'hard', date: '2026-01-12T09:00:00Z' },
            { id: 6, player1: 'Coco Gauff', player2: 'Elena Rybakina', tournament: 'Australian Open', round: 'Semifinale', surface: 'hard', date: '2026-01-12T04:00:00Z' }
        ];

        // ============================================================
        // STATE
        // ============================================================

        let state = {
            apiKey: localStorage.getItem('footballDataApiKey') || '',
            showSetup: !localStorage.getItem('footballDataApiKey'),
            activeSport: 'football',
            selectedLeague: 'SA',
            footballMatches: [],
            loading: false,
            error: null,
            activeTab: 'hot',
            selectedMatch: null,
            analysisData: null,
            history: JSON.parse(localStorage.getItem(DB_KEY) || '[]'),
            historyFilter: 'all'
        };

        // ============================================================
        // ‚öΩ FOOTBALL ALGORITHMS
        // ============================================================

        function getTeamStats(name) {
            for (const [team, stats] of Object.entries(TEAM_STATS)) {
                if (name.toLowerCase().includes(team.toLowerCase()) || team.toLowerCase().includes(name.toLowerCase())) {
                    return stats;
                }
            }
            return { corners: 5.0, cornersAg: 5.0, cards: 2.0, cardsAg: 2.0 };
        }

        function analyzeCorners(home, away) {
            const h = getTeamStats(home);
            const a = getTeamStats(away);
            
            let homeC = (h.corners * 1.08 + a.cornersAg * 0.92) / 2;
            let awayC = (a.corners * 0.92 + h.cornersAg * 1.08) / 2;
            const total = homeC + awayC;
            
            const lines = [8.5, 9.5, 10.5, 11.5];
            const preds = lines.map(line => {
                const diff = total - line;
                const prob = Math.max(18, Math.min(82, 50 + diff * 14));
                return {
                    line,
                    pick: diff > 0 ? 'OVER' : 'UNDER',
                    prob: diff > 0 ? prob : 100 - prob,
                    conf: Math.min(85, 50 + Math.abs(diff) * 9)
                };
            });
            
            return { homeC: homeC.toFixed(1), awayC: awayC.toFixed(1), total: total.toFixed(1), preds, best: preds.reduce((a,b) => a.conf > b.conf ? a : b) };
        }

        function analyzeCards(home, away) {
            const h = getTeamStats(home);
            const a = getTeamStats(away);
            
            let homeCards = (h.cards * 0.88 + a.cardsAg * 1.12) / 2;
            let awayCards = (a.cards * 1.15 + h.cardsAg * 0.85) / 2;
            const total = homeCards + awayCards;
            
            const lines = [3.5, 4.5, 5.5];
            const preds = lines.map(line => {
                const diff = total - line;
                const prob = Math.max(20, Math.min(80, 50 + diff * 18));
                return {
                    line,
                    pick: diff > 0 ? 'OVER' : 'UNDER',
                    prob: diff > 0 ? prob : 100 - prob,
                    conf: Math.min(82, 48 + Math.abs(diff) * 11)
                };
            });
            
            return { homeCards: homeCards.toFixed(1), awayCards: awayCards.toFixed(1), total: total.toFixed(1), preds, best: preds.reduce((a,b) => a.conf > b.conf ? a : b) };
        }

        // ============================================================
        // üèÄ NBA ALGORITHMS
        // ============================================================

        function analyzeNBAGame(game) {
            const home = NBA_TEAMS[game.home];
            const away = NBA_TEAMS[game.away];
            
            const homeExp = (home.avgPts + away.avgAllow) / 2 * 1.02;
            const awayExp = (away.avgPts + home.avgAllow) / 2 * 0.98;
            const totalExp = homeExp + awayExp;
            
            // Total lines
            const lines = [215.5, 220.5, 225.5, 230.5];
            const totalPreds = lines.map(line => {
                const diff = totalExp - line;
                const prob = Math.max(22, Math.min(78, 50 + diff * 3));
                return {
                    line,
                    pick: diff > 0 ? 'OVER' : 'UNDER',
                    prob: diff > 0 ? prob : 100 - prob,
                    conf: Math.min(78, 45 + Math.abs(diff) * 2.5)
                };
            });
            
            // Spread
            const spread = homeExp - awayExp;
            const spreadPred = {
                line: Math.abs(spread).toFixed(1),
                pick: spread > 0 ? game.home : game.away,
                conf: Math.min(75, 48 + Math.abs(spread) * 2)
            };
            
            return {
                homeExp: homeExp.toFixed(1),
                awayExp: awayExp.toFixed(1),
                totalExp: totalExp.toFixed(1),
                totalPreds,
                spreadPred,
                best: totalPreds.reduce((a,b) => a.conf > b.conf ? a : b)
            };
        }

        function analyzePlayerProps(playerName, oppTeam) {
            const player = NBA_PLAYERS[playerName];
            if (!player) return null;
            
            const opp = NBA_TEAMS[oppTeam];
            const defFactor = opp ? (opp.avgAllow / 112) : 1;
            
            // Points prediction
            const expPts = player.ppg * defFactor * (0.95 + Math.random() * 0.1);
            const ptsLines = [player.ppg - 3.5, player.ppg - 0.5, player.ppg + 2.5];
            const ptsPreds = ptsLines.map(line => {
                const diff = expPts - line;
                const prob = Math.max(25, Math.min(75, 50 + diff * 8));
                return {
                    stat: 'PTS',
                    line: line.toFixed(1),
                    pick: diff > 0 ? 'OVER' : 'UNDER',
                    prob: diff > 0 ? prob : 100 - prob,
                    conf: Math.min(76, 48 + Math.abs(diff) * 5)
                };
            });
            
            // Rebounds prediction
            const expReb = player.rpg * (0.92 + Math.random() * 0.16);
            const rebLine = player.rpg - 0.5;
            const rebDiff = expReb - rebLine;
            const rebPred = {
                stat: 'REB',
                line: rebLine.toFixed(1),
                pick: rebDiff > 0 ? 'OVER' : 'UNDER',
                prob: Math.max(30, Math.min(70, 50 + rebDiff * 10)),
                conf: Math.min(72, 45 + Math.abs(rebDiff) * 6)
            };
            
            // Assists prediction
            const expAst = player.apg * (0.90 + Math.random() * 0.2);
            const astLine = player.apg - 0.5;
            const astDiff = expAst - astLine;
            const astPred = {
                stat: 'AST',
                line: astLine.toFixed(1),
                pick: astDiff > 0 ? 'OVER' : 'UNDER',
                prob: Math.max(30, Math.min(70, 50 + astDiff * 10)),
                conf: Math.min(70, 44 + Math.abs(astDiff) * 6)
            };
            
            // PRA (Points + Rebounds + Assists)
            const expPRA = expPts + expReb + expAst;
            const praLine = player.ppg + player.rpg + player.apg - 1.5;
            const praDiff = expPRA - praLine;
            const praPred = {
                stat: 'PRA',
                line: praLine.toFixed(1),
                pick: praDiff > 0 ? 'OVER' : 'UNDER',
                prob: Math.max(28, Math.min(72, 50 + praDiff * 4)),
                conf: Math.min(74, 46 + Math.abs(praDiff) * 3)
            };
            
            const allProps = [...ptsPreds, rebPred, astPred, praPred];
            
            return {
                player: playerName,
                team: player.team,
                avgPts: player.ppg,
                avgReb: player.rpg,
                avgAst: player.apg,
                props: allProps.sort((a,b) => b.conf - a.conf),
                bestProp: allProps.reduce((a,b) => a.conf > b.conf ? a : b)
            };
        }

        // ============================================================
        // üéæ TENNIS ALGORITHMS
        // ============================================================

        function analyzeTennisMatch(match) {
            const p1 = TENNIS_PLAYERS[match.player1];
            const p2 = TENNIS_PLAYERS[match.player2];
            
            if (!p1 || !p2) return null;
            
            const surface = match.surface || 'hard';
            const p1Surface = p1.surface[surface] || 70;
            const p2Surface = p2.surface[surface] || 70;
            
            // Win probability
            const rankDiff = p2.rank - p1.rank;
            const winDiff = p1.winRate - p2.winRate;
            const surfDiff = p1Surface - p2Surface;
            
            let p1WinProb = 50 + rankDiff * 2 + winDiff * 0.3 + surfDiff * 0.2;
            p1WinProb = Math.max(20, Math.min(80, p1WinProb));
            
            // Games prediction
            const avgGames = (p1.avgGames + p2.avgGames) / 2;
            const tightMatch = Math.abs(p1WinProb - 50) < 12;
            const expGames = avgGames + (tightMatch ? 2.5 : -1.5);
            
            const gameLines = [20.5, 21.5, 22.5, 23.5];
            const gamePreds = gameLines.map(line => {
                const diff = expGames - line;
                const prob = Math.max(25, Math.min(75, 50 + diff * 12));
                return {
                    line,
                    pick: diff > 0 ? 'OVER' : 'UNDER',
                    prob: diff > 0 ? prob : 100 - prob,
                    conf: Math.min(78, 46 + Math.abs(diff) * 8)
                };
            });
            
            return {
                p1WinProb: p1WinProb.toFixed(0),
                p2WinProb: (100 - p1WinProb).toFixed(0),
                expGames: expGames.toFixed(1),
                gamePreds,
                winner: {
                    player: p1WinProb > 50 ? match.player1 : match.player2,
                    conf: Math.min(80, 48 + Math.abs(p1WinProb - 50) * 0.7)
                },
                best: gamePreds.reduce((a,b) => a.conf > b.conf ? a : b)
            };
        }

        // ============================================================
        // HOT PICKS GENERATORS
        // ============================================================

        function getFootballHotPicks() {
            const picks = [];
            state.footballMatches.forEach(match => {
                const home = match.homeTeam.shortName || match.homeTeam.name;
                const away = match.awayTeam.shortName || match.awayTeam.name;
                
                const corners = analyzeCorners(home, away);
                const cards = analyzeCards(home, away);
                
                if (corners.best.conf >= 68) {
                    picks.push({ type: 'corner', match, analysis: corners, pred: corners.best });
                }
                if (cards.best.conf >= 65) {
                    picks.push({ type: 'cards', match, analysis: cards, pred: cards.best });
                }
            });
            return picks.sort((a,b) => b.pred.conf - a.pred.conf).slice(0, 8);
        }

        function getNBAHotPicks() {
            const picks = [];
            
            // Game totals
            NBA_GAMES.forEach(game => {
                const analysis = analyzeNBAGame(game);
                if (analysis.best.conf >= 62) {
                    picks.push({ type: 'total', game, analysis, pred: analysis.best });
                }
                if (analysis.spreadPred.conf >= 60) {
                    picks.push({ type: 'spread', game, analysis, pred: analysis.spreadPred });
                }
            });
            
            // Player props
            NBA_GAMES.forEach(game => {
                game.players.forEach(playerName => {
                    const oppTeam = NBA_PLAYERS[playerName]?.team === game.home ? game.away : game.home;
                    const props = analyzePlayerProps(playerName, oppTeam);
                    if (props && props.bestProp.conf >= 65) {
                        picks.push({ type: 'player', game, player: playerName, analysis: props, pred: props.bestProp });
                    }
                });
            });
            
            return picks.sort((a,b) => b.pred.conf - a.pred.conf).slice(0, 10);
        }

        function getTennisHotPicks() {
            const picks = [];
            
            TENNIS_MATCHES.forEach(match => {
                const analysis = analyzeTennisMatch(match);
                if (!analysis) return;
                
                if (analysis.winner.conf >= 62) {
                    picks.push({ type: 'winner', match, analysis, pred: { pick: analysis.winner.player, conf: analysis.winner.conf } });
                }
                if (analysis.best.conf >= 60) {
                    picks.push({ type: 'games', match, analysis, pred: analysis.best });
                }
            });
            
            return picks.sort((a,b) => b.pred.conf - a.pred.conf).slice(0, 8);
        }

        // ============================================================
        // API & DATA LOADING
        // ============================================================

        async function loadFootballMatches() {
            state.loading = true;
            state.error = null;
            render();
            
            try {
                const url = PROXY(`https://api.football-data.org/v4/competitions/${state.selectedLeague}/matches?status=SCHEDULED,TIMED`);
                const res = await fetch(url, { headers: { 'X-Auth-Token': state.apiKey } });
                if (!res.ok) throw new Error('API Error');
                const data = await res.json();
                state.footballMatches = (data.matches || []).slice(0, 15);
            } catch (err) {
                state.error = err.message;
            } finally {
                state.loading = false;
                render();
            }
        }

        // ============================================================
        // HISTORY
        // ============================================================

        function savePick(pick, sport) {
            const entry = {
                id: Date.now(),
                sport,
                type: pick.type,
                description: getPickDescription(pick, sport),
                conf: pick.pred.conf,
                result: null,
                date: new Date().toISOString()
            };
            state.history.unshift(entry);
            localStorage.setItem(DB_KEY, JSON.stringify(state.history));
            render();
            alert('‚úÖ Salvato!');
        }

        function getPickDescription(pick, sport) {
            if (sport === 'football') {
                const home = pick.match.homeTeam?.shortName || pick.match.homeTeam?.name || '';
                const away = pick.match.awayTeam?.shortName || pick.match.awayTeam?.name || '';
                return `${home} vs ${away} - ${pick.type === 'corner' ? 'üö©' : 'üü®'} ${pick.pred.pick} ${pick.pred.line}`;
            }
            if (sport === 'nba') {
                if (pick.type === 'player') {
                    return `${pick.player} - ${pick.pred.stat} ${pick.pred.pick} ${pick.pred.line}`;
                }
                return `${pick.game.home} vs ${pick.game.away} - ${pick.type === 'total' ? `Total ${pick.pred.pick} ${pick.pred.line}` : `${pick.pred.pick} -${pick.pred.line}`}`;
            }
            if (sport === 'tennis') {
                if (pick.type === 'winner') {
                    return `${pick.match.player1} vs ${pick.match.player2} - Vince ${pick.pred.pick}`;
                }
                return `${pick.match.player1} vs ${pick.match.player2} - Games ${pick.pred.pick} ${pick.pred.line}`;
            }
            return '';
        }

        function updateResult(id, won) {
            const entry = state.history.find(e => e.id === id);
            if (entry) {
                entry.result = won ? 'won' : 'lost';
                localStorage.setItem(DB_KEY, JSON.stringify(state.history));
                render();
            }
        }

        function getStats() {
            const resolved = state.history.filter(e => e.result !== null);
            const won = resolved.filter(e => e.result === 'won').length;
            return {
                total: state.history.length,
                won,
                lost: resolved.length - won,
                hitRate: resolved.length > 0 ? (won / resolved.length * 100).toFixed(1) : 0
            };
        }

        // ============================================================
        // RENDER HELPERS
        // ============================================================

        function formatDate(d) {
            const date = new Date(d);
            return {
                date: date.toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit' }),
                time: date.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' })
            };
        }

        function confBadge(v, sport = 'football') {
            const colors = {
                football: v >= 70 ? 'from-emerald-400 to-cyan-500' : v >= 58 ? 'from-amber-400 to-orange-500' : 'from-red-400 to-pink-500',
                nba: v >= 68 ? 'from-orange-400 to-yellow-500' : v >= 55 ? 'from-amber-400 to-orange-500' : 'from-red-400 to-pink-500',
                tennis: v >= 68 ? 'from-purple-400 to-pink-500' : v >= 55 ? 'from-amber-400 to-orange-500' : 'from-red-400 to-pink-500'
            };
            return `<span class="px-2.5 py-1 rounded-full text-xs font-bold bg-gradient-to-r ${colors[sport]} text-white">${Math.round(v)}%</span>`;
        }

        // ============================================================
        // MAIN RENDER
        // ============================================================

        function render() {
            const root = document.getElementById('root');

            // SETUP
            if (state.showSetup) {
                root.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="glass rounded-3xl p-8 max-w-md w-full slide-up">
                            <div class="text-center mb-8">
                                <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-emerald-400 to-cyan-500 flex items-center justify-center mx-auto mb-4 glow">
                                    <span class="text-4xl">üéØ</span>
                                </div>
                                <h1 class="text-3xl font-black gradient-text">ULTRA BET V5</h1>
                                <p class="text-gray-500 mt-1">Football ‚Ä¢ NBA ‚Ä¢ Tennis</p>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-3 mb-6">
                                <div class="glass rounded-xl p-4 text-center">
                                    <span class="text-3xl">‚öΩ</span>
                                    <p class="text-xs text-gray-500 mt-2">Corner & Cards</p>
                                </div>
                                <div class="glass rounded-xl p-4 text-center">
                                    <span class="text-3xl">üèÄ</span>
                                    <p class="text-xs text-gray-500 mt-2">NBA Props</p>
                                </div>
                                <div class="glass rounded-xl p-4 text-center">
                                    <span class="text-3xl">üéæ</span>
                                    <p class="text-xs text-gray-500 mt-2">Tennis</p>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-400 mb-2">üîë API Key (football-data.org)</label>
                                <input id="apiKeyInput" type="text" placeholder="Inserisci token..." class="w-full px-4 py-3 rounded-xl text-center"/>
                                <a href="https://www.football-data.org/client/register" target="_blank" class="text-xs text-cyan-400 block mt-2 text-center">Registrati gratis ‚Üí</a>
                            </div>
                            
                            <button onclick="saveKey()" class="w-full py-4 rounded-xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-500 text-gray-900">
                                üöÄ INIZIA
                            </button>
                        </div>
                    </div>
                `;
                return;
            }

            let content = '';
            const sport = state.activeSport;

            // ================== HOT PICKS TAB ==================
            if (state.activeTab === 'hot') {
                if (sport === 'football') {
                    if (state.loading) {
                        content = `<div class="glass rounded-2xl p-8 text-center"><div class="w-10 h-10 border-4 border-cyan-400 border-t-transparent rounded-full loader mx-auto"></div><p class="mt-4 text-gray-500">Caricamento...</p></div>`;
                    } else {
                        const picks = getFootballHotPicks();
                        content = `
                            <div class="flex gap-2 overflow-x-auto pb-3 mb-4">
                                ${Object.entries(FOOTBALL_LEAGUES).map(([code, l]) => `
                                    <button onclick="state.selectedLeague='${code}';loadFootballMatches()" class="px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap ${state.selectedLeague === code ? 'tab-football text-gray-900' : 'glass text-gray-400'}">
                                        ${l.flag} ${l.name}
                                    </button>
                                `).join('')}
                            </div>
                            
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-lg font-bold">üî• <span class="gradient-text">HOT PICKS</span></h2>
                                <button onclick="loadFootballMatches()" class="glass px-3 py-1.5 rounded-lg text-xs">üîÑ</button>
                            </div>
                            
                            <div class="space-y-3">
                                ${picks.length === 0 ? '<p class="glass rounded-xl p-8 text-center text-gray-500">Carica partite per vedere i picks</p>' : ''}
                                ${picks.map((pick, i) => {
                                    const home = pick.match.homeTeam?.shortName || pick.match.homeTeam?.name;
                                    const away = pick.match.awayTeam?.shortName || pick.match.awayTeam?.name;
                                    const { date, time } = formatDate(pick.match.utcDate);
                                    const isHot = pick.pred.conf >= 72;
                                    
                                    return `
                                        <div class="glass rounded-xl p-4 slide-up ${isHot ? 'hot-badge' : ''}" style="animation-delay:${i*40}ms">
                                            <div class="flex items-center justify-between mb-3">
                                                <div class="flex items-center gap-3">
                                                    <span class="text-2xl">${pick.type === 'corner' ? 'üö©' : 'üü®'}</span>
                                                    <div>
                                                        <p class="font-bold text-white text-sm">${home} vs ${away}</p>
                                                        <p class="text-xs text-gray-500">${date} ‚Ä¢ ${time}</p>
                                                    </div>
                                                </div>
                                                ${confBadge(pick.pred.conf, 'football')}
                                            </div>
                                            <div class="flex items-center justify-between bg-black/30 rounded-lg p-3">
                                                <div>
                                                    <p class="text-xs text-gray-500">${pick.type === 'corner' ? 'Corner' : 'Cards'}</p>
                                                    <p class="text-lg font-black text-white">${pick.pred.pick} ${pick.pred.line}</p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-xs text-gray-500">Expected</p>
                                                    <p class="font-bold text-cyan-400">${pick.analysis.total}</p>
                                                </div>
                                                <button onclick='savePick(${JSON.stringify(pick).replace(/'/g, "\\'")},"football")' class="ml-2 bg-gradient-to-r from-emerald-400 to-cyan-500 text-gray-900 px-3 py-2 rounded-lg text-xs font-bold">üíæ</button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `;
                    }
                }
                
                // NBA HOT PICKS
                if (sport === 'nba') {
                    const picks = getNBAHotPicks();
                    content = `
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-bold">üî• <span class="gradient-orange">NBA HOT PICKS</span></h2>
                            <span class="text-xs text-gray-500">${NBA_GAMES.length} partite</span>
                        </div>
                        
                        <div class="space-y-3">
                            ${picks.map((pick, i) => {
                                const { date, time } = formatDate(pick.game.date);
                                const isPlayer = pick.type === 'player';
                                
                                return `
                                    <div class="glass rounded-xl p-4 slide-up ${pick.pred.conf >= 68 ? 'glow-orange' : ''}" style="animation-delay:${i*40}ms">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <span class="text-xl">${isPlayer ? 'üë§' : 'üèÄ'}</span>
                                                <div>
                                                    ${isPlayer ? `
                                                        <p class="font-bold text-white text-sm">${pick.player}</p>
                                                        <p class="text-xs text-gray-500">${pick.game.home} vs ${pick.game.away}</p>
                                                    ` : `
                                                        <p class="font-bold text-white text-sm">${NBA_TEAMS[pick.game.home]?.logo || ''} ${pick.game.home} vs ${pick.game.away} ${NBA_TEAMS[pick.game.away]?.logo || ''}</p>
                                                        <p class="text-xs text-gray-500">${date} ‚Ä¢ ${time}</p>
                                                    `}
                                                </div>
                                            </div>
                                            ${confBadge(pick.pred.conf, 'nba')}
                                        </div>
                                        <div class="flex items-center justify-between bg-orange-500/10 rounded-lg p-3">
                                            <div>
                                                <p class="text-xs text-gray-500">${isPlayer ? pick.pred.stat : (pick.type === 'total' ? 'Total Points' : 'Spread')}</p>
                                                <p class="text-lg font-black text-white">${pick.pred.pick} ${pick.pred.line}</p>
                                            </div>
                                            ${isPlayer ? `
                                                <div class="text-right">
                                                    <p class="text-xs text-gray-500">Season Avg</p>
                                                    <p class="font-bold text-orange-400">${pick.analysis.avgPts} PPG</p>
                                                </div>
                                            ` : `
                                                <div class="text-right">
                                                    <p class="text-xs text-gray-500">Expected</p>
                                                    <p class="font-bold text-orange-400">${pick.analysis.totalExp}</p>
                                                </div>
                                            `}
                                            <button onclick='savePick(${JSON.stringify(pick).replace(/'/g, "\\'")},"nba")' class="ml-2 bg-gradient-to-r from-orange-400 to-yellow-500 text-gray-900 px-3 py-2 rounded-lg text-xs font-bold">üíæ</button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }
                
                // TENNIS HOT PICKS
                if (sport === 'tennis') {
                    const picks = getTennisHotPicks();
                    content = `
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-bold">üî• <span class="gradient-purple">TENNIS HOT PICKS</span></h2>
                            <span class="text-xs text-gray-500">Australian Open</span>
                        </div>
                        
                        <div class="space-y-3">
                            ${picks.map((pick, i) => {
                                const { date, time } = formatDate(pick.match.date);
                                const isWinner = pick.type === 'winner';
                                
                                return `
                                    <div class="glass rounded-xl p-4 slide-up ${pick.pred.conf >= 68 ? 'glow-purple' : ''}" style="animation-delay:${i*40}ms">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <span class="text-xl">${isWinner ? 'üèÜ' : 'üéæ'}</span>
                                                <div>
                                                    <p class="font-bold text-white text-sm">${pick.match.player1} vs ${pick.match.player2}</p>
                                                    <p class="text-xs text-gray-500">${pick.match.tournament} ‚Ä¢ ${pick.match.round}</p>
                                                </div>
                                            </div>
                                            ${confBadge(pick.pred.conf, 'tennis')}
                                        </div>
                                        <div class="flex items-center justify-between bg-purple-500/10 rounded-lg p-3">
                                            <div>
                                                <p class="text-xs text-gray-500">${isWinner ? 'Vincente' : 'Total Games'}</p>
                                                <p class="text-lg font-black text-white">${isWinner ? pick.pred.pick : `${pick.pred.pick} ${pick.pred.line}`}</p>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-xs text-gray-500">${isWinner ? 'Win Prob' : 'Expected'}</p>
                                                <p class="font-bold text-purple-400">${isWinner ? pick.analysis.p1WinProb + '%' : pick.analysis.expGames}</p>
                                            </div>
                                            <button onclick='savePick(${JSON.stringify(pick).replace(/'/g, "\\'")},"tennis")' class="ml-2 bg-gradient-to-r from-purple-400 to-pink-500 text-white px-3 py-2 rounded-lg text-xs font-bold">üíæ</button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }
            }

            // ================== MATCHES/GAMES TAB ==================
            if (state.activeTab === 'matches') {
                if (sport === 'football') {
                    content = `
                        <div class="flex gap-2 overflow-x-auto pb-3 mb-4">
                            ${Object.entries(FOOTBALL_LEAGUES).map(([code, l]) => `
                                <button onclick="state.selectedLeague='${code}';loadFootballMatches()" class="px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap ${state.selectedLeague === code ? 'tab-football text-gray-900' : 'glass text-gray-400'}">
                                    ${l.flag} ${l.name}
                                </button>
                            `).join('')}
                        </div>
                        <div class="glass rounded-xl overflow-hidden">
                            <div class="px-4 py-3 border-b border-white/5 flex justify-between">
                                <span class="font-bold">${FOOTBALL_LEAGUES[state.selectedLeague].flag} Partite</span>
                                <button onclick="loadFootballMatches()" class="text-cyan-400 text-sm">üîÑ</button>
                            </div>
                            <div class="max-h-[400px] overflow-y-auto">
                                ${state.footballMatches.length === 0 ? '<p class="p-8 text-center text-gray-500">Nessuna partita</p>' : ''}
                                ${state.footballMatches.map((m, i) => {
                                    const { date, time } = formatDate(m.utcDate);
                                    return `
                                        <div class="px-4 py-3 border-b border-white/5 hover:bg-white/5 cursor-pointer" onclick="analyzeFootballMatch(${i})">
                                            <div class="flex justify-between items-center">
                                                <div>
                                                    <p class="font-medium text-white text-sm">${m.homeTeam.shortName || m.homeTeam.name}</p>
                                                    <p class="text-gray-500 text-sm">${m.awayTeam.shortName || m.awayTeam.name}</p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-xs text-gray-500">${date}</p>
                                                    <p class="font-bold text-cyan-400">${time}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }
                
                if (sport === 'nba') {
                    content = `
                        <h3 class="font-bold mb-4">üèÄ NBA Games</h3>
                        <div class="space-y-3">
                            ${NBA_GAMES.map((game, i) => {
                                const { date, time } = formatDate(game.date);
                                const analysis = analyzeNBAGame(game);
                                return `
                                    <div class="glass rounded-xl p-4 cursor-pointer hover:bg-white/5" onclick="analyzeNBAMatch(${i})">
                                        <div class="flex justify-between items-center mb-2">
                                            <div>
                                                <p class="font-bold text-white">${NBA_TEAMS[game.home]?.logo || ''} ${game.home} vs ${game.away} ${NBA_TEAMS[game.away]?.logo || ''}</p>
                                                <p class="text-xs text-gray-500">${date} ‚Ä¢ ${time}</p>
                                            </div>
                                        </div>
                                        <div class="flex gap-2 text-xs">
                                            <span class="bg-orange-500/20 text-orange-400 px-2 py-1 rounded">Total: ${analysis.totalExp}</span>
                                            <span class="bg-white/10 text-gray-400 px-2 py-1 rounded">Players: ${game.players.length}</span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }
                
                if (sport === 'tennis') {
                    content = `
                        <h3 class="font-bold mb-4">üéæ Tennis Matches</h3>
                        <div class="space-y-3">
                            ${TENNIS_MATCHES.map((match, i) => {
                                const { date, time } = formatDate(match.date);
                                const p1 = TENNIS_PLAYERS[match.player1];
                                const p2 = TENNIS_PLAYERS[match.player2];
                                return `
                                    <div class="glass rounded-xl p-4 cursor-pointer hover:bg-white/5" onclick="analyzeTennisMatchUI(${i})">
                                        <div class="flex justify-between items-center mb-2">
                                            <div>
                                                <p class="font-bold text-white">${match.player1} vs ${match.player2}</p>
                                                <p class="text-xs text-gray-500">${match.tournament} ‚Ä¢ ${match.round}</p>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-xs text-gray-500">${date}</p>
                                                <p class="font-bold text-purple-400">${time}</p>
                                            </div>
                                        </div>
                                        <div class="flex gap-2 text-xs">
                                            <span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded">#${p1?.rank || '?'} vs #${p2?.rank || '?'}</span>
                                            <span class="bg-white/10 text-gray-400 px-2 py-1 rounded">${match.surface}</span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }
            }

            // ================== ANALYSIS TAB ==================
            if (state.activeTab === 'analysis') {
                if (!state.analysisData) {
                    content = `<div class="glass rounded-xl p-12 text-center"><p class="text-4xl mb-2">üéØ</p><p class="text-gray-500">Seleziona una partita</p></div>`;
                } else {
                    const a = state.analysisData;
                    
                    if (a.sport === 'football') {
                        content = `
                            <div class="glass rounded-xl p-4 mb-4 glow">
                                <div class="text-center">
                                    <p class="text-lg font-black text-white">${a.home} vs ${a.away}</p>
                                    <p class="text-xs text-gray-500">${a.date} ‚Ä¢ ${a.time}</p>
                                </div>
                            </div>
                            
                            <!-- CORNERS -->
                            <div class="glass rounded-xl overflow-hidden mb-4">
                                <div class="px-4 py-2 bg-cyan-500/10 border-b border-white/5">
                                    <span class="font-bold">üö© CORNER</span>
                                </div>
                                <div class="p-4">
                                    <div class="grid grid-cols-3 gap-2 mb-4 text-center">
                                        <div class="bg-black/30 rounded-lg p-3"><p class="text-xs text-gray-500">${a.home}</p><p class="text-xl font-bold text-cyan-400">${a.corners.homeC}</p></div>
                                        <div class="bg-cyan-500/20 rounded-lg p-3 glow"><p class="text-xs text-gray-400">TOT</p><p class="text-2xl font-black text-white">${a.corners.total}</p></div>
                                        <div class="bg-black/30 rounded-lg p-3"><p class="text-xs text-gray-500">${a.away}</p><p class="text-xl font-bold text-cyan-400">${a.corners.awayC}</p></div>
                                    </div>
                                    <div class="space-y-2">
                                        ${a.corners.preds.map(p => `
                                            <div class="flex items-center justify-between p-3 rounded-lg ${p === a.corners.best ? 'bg-cyan-500/20 border border-cyan-500/30' : 'bg-white/5'}">
                                                <span class="font-bold text-white">${p === a.corners.best ? '‚≠ê ' : ''}${p.pick} ${p.line}</span>
                                                ${confBadge(p.conf, 'football')}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- CARDS -->
                            <div class="glass rounded-xl overflow-hidden">
                                <div class="px-4 py-2 bg-amber-500/10 border-b border-white/5">
                                    <span class="font-bold">üü® CARTELLINI</span>
                                </div>
                                <div class="p-4">
                                    <div class="grid grid-cols-3 gap-2 mb-4 text-center">
                                        <div class="bg-black/30 rounded-lg p-3"><p class="text-xs text-gray-500">${a.home}</p><p class="text-xl font-bold text-amber-400">${a.cards.homeCards}</p></div>
                                        <div class="bg-amber-500/20 rounded-lg p-3"><p class="text-xs text-gray-400">TOT</p><p class="text-2xl font-black text-white">${a.cards.total}</p></div>
                                        <div class="bg-black/30 rounded-lg p-3"><p class="text-xs text-gray-500">${a.away}</p><p class="text-xl font-bold text-amber-400">${a.cards.awayCards}</p></div>
                                    </div>
                                    <div class="space-y-2">
                                        ${a.cards.preds.map(p => `
                                            <div class="flex items-center justify-between p-3 rounded-lg ${p === a.cards.best ? 'bg-amber-500/20 border border-amber-500/30' : 'bg-white/5'}">
                                                <span class="font-bold text-white">${p === a.cards.best ? '‚≠ê ' : ''}${p.pick} ${p.line}</span>
                                                ${confBadge(p.conf, 'football')}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    if (a.sport === 'nba') {
                        content = `
                            <div class="glass rounded-xl p-4 mb-4 glow-orange">
                                <div class="text-center">
                                    <p class="text-lg font-black text-white">${NBA_TEAMS[a.game.home]?.logo || ''} ${a.game.home} vs ${a.game.away} ${NBA_TEAMS[a.game.away]?.logo || ''}</p>
                                    <p class="text-xs text-gray-500">${a.date} ‚Ä¢ ${a.time}</p>
                                </div>
                            </div>
                            
                            <!-- TOTALS -->
                            <div class="glass rounded-xl overflow-hidden mb-4">
                                <div class="px-4 py-2 bg-orange-500/10 border-b border-white/5">
                                    <span class="font-bold">üèÄ TOTAL POINTS</span>
                                </div>
                                <div class="p-4">
                                    <div class="grid grid-cols-3 gap-2 mb-4 text-center">
                                        <div class="bg-black/30 rounded-lg p-3"><p class="text-xs text-gray-500">${a.game.home}</p><p class="text-xl font-bold text-orange-400">${a.analysis.homeExp}</p></div>
                                        <div class="bg-orange-500/20 rounded-lg p-3"><p class="text-xs text-gray-400">TOT</p><p class="text-2xl font-black text-white">${a.analysis.totalExp}</p></div>
                                        <div class="bg-black/30 rounded-lg p-3"><p class="text-xs text-gray-500">${a.game.away}</p><p class="text-xl font-bold text-orange-400">${a.analysis.awayExp}</p></div>
                                    </div>
                                    <div class="space-y-2">
                                        ${a.analysis.totalPreds.map(p => `
                                            <div class="flex items-center justify-between p-3 rounded-lg ${p === a.analysis.best ? 'bg-orange-500/20 border border-orange-500/30' : 'bg-white/5'}">
                                                <span class="font-bold text-white">${p === a.analysis.best ? '‚≠ê ' : ''}${p.pick} ${p.line}</span>
                                                ${confBadge(p.conf, 'nba')}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- PLAYER PROPS -->
                            <div class="glass rounded-xl overflow-hidden">
                                <div class="px-4 py-2 bg-yellow-500/10 border-b border-white/5">
                                    <span class="font-bold">üë§ PLAYER PROPS</span>
                                </div>
                                <div class="p-4 space-y-3">
                                    ${a.game.players.map(playerName => {
                                        const oppTeam = NBA_PLAYERS[playerName]?.team === a.game.home ? a.game.away : a.game.home;
                                        const props = analyzePlayerProps(playerName, oppTeam);
                                        if (!props) return '';
                                        return `
                                            <div class="bg-black/30 rounded-lg p-3">
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="font-bold text-white">${playerName}</span>
                                                    <span class="text-xs text-gray-500">${props.avgPts} PPG / ${props.avgReb} RPG / ${props.avgAst} APG</span>
                                                </div>
                                                <div class="grid grid-cols-2 gap-2">
                                                    ${props.props.slice(0, 4).map(p => `
                                                        <div class="flex items-center justify-between bg-white/5 rounded p-2">
                                                            <span class="text-xs text-white">${p.stat} ${p.pick} ${p.line}</span>
                                                            ${confBadge(p.conf, 'nba')}
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `;
                    }
                    
                    if (a.sport === 'tennis') {
                        content = `
                            <div class="glass rounded-xl p-4 mb-4 glow-purple">
                                <div class="text-center">
                                    <p class="text-lg font-black text-white">${a.match.player1} vs ${a.match.player2}</p>
                                    <p class="text-xs text-gray-500">${a.match.tournament} ‚Ä¢ ${a.match.round}</p>
                                </div>
                            </div>
                            
                            <!-- WINNER -->
                            <div class="glass rounded-xl overflow-hidden mb-4">
                                <div class="px-4 py-2 bg-purple-500/10 border-b border-white/5">
                                    <span class="font-bold">üèÜ VINCENTE</span>
                                </div>
                                <div class="p-4">
                                    <div class="grid grid-cols-2 gap-3 mb-4">
                                        <div class="bg-black/30 rounded-lg p-4 text-center ${a.analysis.p1WinProb > 50 ? 'border-2 border-purple-500' : ''}">
                                            <p class="font-bold text-white">${a.match.player1}</p>
                                            <p class="text-3xl font-black text-purple-400">${a.analysis.p1WinProb}%</p>
                                        </div>
                                        <div class="bg-black/30 rounded-lg p-4 text-center ${a.analysis.p2WinProb > 50 ? 'border-2 border-purple-500' : ''}">
                                            <p class="font-bold text-white">${a.match.player2}</p>
                                            <p class="text-3xl font-black text-purple-400">${a.analysis.p2WinProb}%</p>
                                        </div>
                                    </div>
                                    <div class="bg-purple-500/20 rounded-lg p-3 flex items-center justify-between">
                                        <span class="font-bold text-white">‚≠ê ${a.analysis.winner.player}</span>
                                        ${confBadge(a.analysis.winner.conf, 'tennis')}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- GAMES -->
                            <div class="glass rounded-xl overflow-hidden">
                                <div class="px-4 py-2 bg-pink-500/10 border-b border-white/5">
                                    <span class="font-bold">üéæ TOTAL GAMES</span>
                                </div>
                                <div class="p-4">
                                    <div class="text-center mb-4 bg-black/30 rounded-lg p-3">
                                        <p class="text-xs text-gray-500">Expected Games</p>
                                        <p class="text-3xl font-black text-pink-400">${a.analysis.expGames}</p>
                                    </div>
                                    <div class="space-y-2">
                                        ${a.analysis.gamePreds.map(p => `
                                            <div class="flex items-center justify-between p-3 rounded-lg ${p === a.analysis.best ? 'bg-pink-500/20 border border-pink-500/30' : 'bg-white/5'}">
                                                <span class="font-bold text-white">${p === a.analysis.best ? '‚≠ê ' : ''}${p.pick} ${p.line}</span>
                                                ${confBadge(p.conf, 'tennis')}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }
            }

            // ================== STATS TAB ==================
            if (state.activeTab === 'stats') {
                const stats = getStats();
                const filtered = state.historyFilter === 'all' ? state.history : state.history.filter(e => e.result === state.historyFilter || (state.historyFilter === 'pending' && e.result === null));
                
                content = `
                    <div class="glass rounded-xl p-5 mb-4 glow">
                        <h3 class="font-bold text-center mb-4">üìä STATISTICHE</h3>
                        <div class="grid grid-cols-4 gap-2 text-center">
                            <div class="bg-white/5 rounded-lg p-3"><p class="text-2xl font-black text-white">${stats.total}</p><p class="text-xs text-gray-500">Tot</p></div>
                            <div class="bg-emerald-500/20 rounded-lg p-3"><p class="text-2xl font-black text-emerald-400">${stats.won}</p><p class="text-xs text-gray-500">Vinti</p></div>
                            <div class="bg-red-500/20 rounded-lg p-3"><p class="text-2xl font-black text-red-400">${stats.lost}</p><p class="text-xs text-gray-500">Persi</p></div>
                            <div class="bg-cyan-500/20 rounded-lg p-3"><p class="text-2xl font-black text-cyan-400">${stats.hitRate}%</p><p class="text-xs text-gray-500">Hit</p></div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 mb-4">
                        ${['all', 'pending', 'won', 'lost'].map(f => `
                            <button onclick="state.historyFilter='${f}';render()" class="px-4 py-2 rounded-lg text-xs font-bold ${state.historyFilter === f ? 'bg-gradient-to-r from-emerald-400 to-cyan-500 text-gray-900' : 'glass text-gray-400'}">
                                ${f === 'all' ? 'Tutti' : f === 'pending' ? '‚è≥' : f === 'won' ? '‚úÖ' : '‚ùå'}
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="space-y-2">
                        ${filtered.length === 0 ? '<p class="glass rounded-xl p-8 text-center text-gray-500">Nessun pick</p>' : ''}
                        ${filtered.map(e => {
                            const sportIcon = e.sport === 'football' ? '‚öΩ' : e.sport === 'nba' ? 'üèÄ' : 'üéæ';
                            const statusCls = e.result === 'won' ? 'border-emerald-500/30 bg-emerald-500/10' : e.result === 'lost' ? 'border-red-500/30 bg-red-500/10' : '';
                            return `
                                <div class="glass rounded-lg p-3 border ${statusCls}">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <span>${sportIcon}</span>
                                            <div>
                                                <p class="text-sm font-medium text-white">${e.description}</p>
                                                <p class="text-xs text-gray-500">${e.conf.toFixed(0)}% conf</p>
                                            </div>
                                        </div>
                                        ${e.result === null ? `
                                            <div class="flex gap-1">
                                                <button onclick="updateResult(${e.id}, true)" class="bg-emerald-500 text-white px-2 py-1 rounded text-xs">‚úì</button>
                                                <button onclick="updateResult(${e.id}, false)" class="bg-red-500 text-white px-2 py-1 rounded text-xs">‚úó</button>
                                            </div>
                                        ` : `<span class="text-xl">${e.result === 'won' ? '‚úÖ' : '‚ùå'}</span>`}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    ${state.history.length > 0 ? `<button onclick="if(confirm('Cancellare?')){state.history=[];localStorage.setItem('${DB_KEY}','[]');render()}" class="w-full mt-4 py-2 glass rounded-lg text-red-400 text-sm">üóëÔ∏è Cancella</button>` : ''}
                `;
            }

            // MAIN LAYOUT
            const sportColors = { football: 'from-emerald-400 to-cyan-500', nba: 'from-orange-400 to-yellow-500', tennis: 'from-purple-400 to-pink-500' };
            
            root.innerHTML = `
                <div class="max-w-lg mx-auto min-h-screen flex flex-col">
                    <header class="glass sticky top-0 z-50 border-b border-white/5">
                        <div class="px-4 py-3 flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <div class="w-9 h-9 rounded-xl bg-gradient-to-br ${sportColors[sport]} flex items-center justify-center">
                                    <span class="text-lg">${sport === 'football' ? '‚öΩ' : sport === 'nba' ? 'üèÄ' : 'üéæ'}</span>
                                </div>
                                <div>
                                    <h1 class="font-black text-white text-sm">ULTRA BET</h1>
                                    <p class="text-[10px] text-gray-500">V5</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-1 glass rounded-xl p-1">
                                <button onclick="state.activeSport='football';state.activeTab='hot';render()" class="px-3 py-1.5 rounded-lg text-sm ${sport === 'football' ? 'bg-gradient-to-r from-emerald-400 to-cyan-500 text-gray-900 font-bold' : 'text-gray-500'}">‚öΩ</button>
                                <button onclick="state.activeSport='nba';state.activeTab='hot';render()" class="px-3 py-1.5 rounded-lg text-sm ${sport === 'nba' ? 'bg-gradient-to-r from-orange-400 to-yellow-500 text-gray-900 font-bold' : 'text-gray-500'}">üèÄ</button>
                                <button onclick="state.activeSport='tennis';state.activeTab='hot';render()" class="px-3 py-1.5 rounded-lg text-sm ${sport === 'tennis' ? 'bg-gradient-to-r from-purple-400 to-pink-500 text-white font-bold' : 'text-gray-500'}">üéæ</button>
                            </div>
                        </div>
                        
                        <div class="flex px-3 pb-2 gap-1">
                            <button onclick="state.activeTab='hot';render()" class="flex-1 py-2 rounded-lg text-xs font-bold ${state.activeTab === 'hot' ? 'bg-gradient-to-r ' + sportColors[sport] + ' text-gray-900' : 'text-gray-500'}">üî• Hot</button>
                            <button onclick="state.activeTab='matches';render()" class="flex-1 py-2 rounded-lg text-xs font-bold ${state.activeTab === 'matches' ? 'bg-gradient-to-r ' + sportColors[sport] + ' text-gray-900' : 'text-gray-500'}">üìÖ Match</button>
                            <button onclick="state.activeTab='analysis';render()" class="flex-1 py-2 rounded-lg text-xs font-bold ${state.activeTab === 'analysis' ? 'bg-gradient-to-r ' + sportColors[sport] + ' text-gray-900' : 'text-gray-500'}">üéØ Analisi</button>
                            <button onclick="state.activeTab='stats';render()" class="flex-1 py-2 rounded-lg text-xs font-bold ${state.activeTab === 'stats' ? 'bg-gradient-to-r ' + sportColors[sport] + ' text-gray-900' : 'text-gray-500'}">üìä Stats</button>
                        </div>
                    </header>
                    
                    <main class="flex-1 p-4 pb-20">${content}</main>
                    
                    <footer class="fixed bottom-0 left-0 right-0 glass border-t border-white/5 p-2 flex justify-between items-center text-xs text-gray-600 max-w-lg mx-auto">
                        <span>üéØ Ultra Bet V5</span>
                        <button onclick="localStorage.clear();location.reload()" class="text-red-400">Reset</button>
                    </footer>
                </div>
            `;
        }

        // ============================================================
        // ACTIONS
        // ============================================================

        function saveKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                localStorage.setItem('footballDataApiKey', key);
                state.apiKey = key;
                state.showSetup = false;
                render();
                loadFootballMatches();
            }
        }

        function analyzeFootballMatch(i) {
            const m = state.footballMatches[i];
            const home = m.homeTeam.shortName || m.homeTeam.name;
            const away = m.awayTeam.shortName || m.awayTeam.name;
            const { date, time } = formatDate(m.utcDate);
            
            state.analysisData = {
                sport: 'football',
                match: m,
                home, away, date, time,
                corners: analyzeCorners(home, away),
                cards: analyzeCards(home, away)
            };
            state.activeTab = 'analysis';
            render();
        }

        function analyzeNBAMatch(i) {
            const game = NBA_GAMES[i];
            const { date, time } = formatDate(game.date);
            
            state.analysisData = {
                sport: 'nba',
                game,
                date, time,
                analysis: analyzeNBAGame(game)
            };
            state.activeTab = 'analysis';
            render();
        }

        function analyzeTennisMatchUI(i) {
            const match = TENNIS_MATCHES[i];
            const { date, time } = formatDate(match.date);
            
            state.analysisData = {
                sport: 'tennis',
                match,
                date, time,
                analysis: analyzeTennisMatch(match)
            };
            state.activeTab = 'analysis';
            render();
        }

        // INIT
        render();
        if (state.apiKey && !state.showSetup) loadFootballMatches();
    </script>
</body>
</html>
