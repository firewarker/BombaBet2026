<!doctype html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BOMBA BET PRO - Corners Cards GG</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0f;
      --glass: rgba(255,255,255,0.05);
      --border: rgba(255,255,255,0.1);
      --text: #e4e4e7;
      --text-sec: #a1a1aa;
      --success: #00d4aa;
      --warn: #f59e0b;
      --danger: #ef4444;
      --grad-main: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --grad-success: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
      --grad-warn: linear-gradient(135deg, #f59e0b 0%, #f39c12 100%);
      --grad-danger: linear-gradient(135deg, #ef4444 0%, #e74c3c 100%);
    }
    body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; }
    .glass { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border); }
    .glass-hover:hover { background: rgba(255,255,255,0.1); transform: translateY(-4px); }
    .loader { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.5; } }
    .conf-high { background: var(--grad-success); }
    .conf-mid { background: var(--grad-warn); }
    .conf-low { background: var(--grad-danger); }
    .neon { box-shadow: 0 0 20px currentColor; }
  </style>
</head>
<body class="min-h-screen p-4 md:p-8">
  <div id="app" class="max-w-4xl mx-auto">
    <header class="glass rounded-3xl p-8 mb-8 text-center shadow-2xl">
      <div class="mb-6">
        <div class="w-24 h-24 mx-auto rounded-3xl bg-gradient-to-br from-emerald-500 to-cyan-600 flex items-center justify-center text-4xl font-black shadow-2xl mb-4">
          <i class="fas fa-bomb text-black"></i>
        </div>
        <h1 class="text-5xl font-black bg-gradient-to-r from-white to-gray-200 bg-clip-text text-transparent mb-2">BOMBA BET PRO</h1>
        <p class="text-xl text-cyan-400 font-semibold">Prono Corners • Cards • GG | FootyStats Edition</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="glass p-6 rounded-2xl text-center">
          <i class="fas fa-futbol text-3xl text-emerald-400 mb-3"></i>
          <div class="font-bold text-lg">Calcio Live</div>
          <div class="text-sm text-gray-400">SportAPI7</div>
        </div>
        <div class="glass p-6 rounded-2xl text-center">
          <i class="fas fa-chart-bar text-3xl text-amber-400 mb-3"></i>
          <div class="font-bold text-lg">Stats Reali</div>
          <div class="text-sm text-gray-400">FootyStats[web:1]</div>
        </div>
        <div class="glass p-6 rounded-2xl text-center">
          <i class="fas fa-shield-alt text-3xl text-purple-400 mb-3"></i>
          <div class="font-bold text-lg">Anti-RateLimit</div>
          <div class="text-sm text-gray-400">Throttle + Cache</div>
        </div>
      </div>
      <div class="grid grid-cols-1 md:flex md:gap-4">
        <input id="dateInput" type="date" class="glass p-4 rounded-2xl text-lg font-bold w-full md:w-80 mb-4 md:mb-0 focus:ring-4 ring-cyan-500/30">
        <button id="btnLoad" class="bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 text-white font-bold py-4 px-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all glass-hover">
          <i class="fas fa-rocket mr-2"></i>Carica Partite
        </button>
        <button id="btnKey" class="glass p-4 rounded-2xl font-bold hover:bg-white/20 transition-all">
          <i class="fas fa-key mr-2"></i>API Key
        </button>
        <button id="btnClearCache" class="glass p-4 rounded-2xl font-bold text-red-400 hover:bg-red-500/20 transition-all">
          <i class="fas fa-trash mr-2"></i>Reset
        </button>
      </div>
      <div id="statusLine" class="glass p-4 rounded-2xl mt-6 text-sm font-mono text-center"></div>
    </header>
    <main id="content"></main>
  </div>
<script>
const RAPIDAPI_HOST = "sportapi7.p.rapidapi.com";
const API_BASE = "/api/v1";
let RAPIDAPI_KEY = localStorage.getItem('RAPIDAPI_KEY') || '';
const ENDPOINTS = { scheduledEvents: (sport, date) => `${API_BASE}/sport/football/scheduled-events/${date}` };
const CACHE_TTL = 60*1000;
const MIN_DELAY = 700;

// FootyStats-inspired stats [web:1]
const FOOTYSTATS = {
  cards: {'Juventus':4.2,'Inter':4.8,'Milan':4.5,'Napoli':5.1,'Roma':5.3,'Atalanta':4.9,'Lazio':4.7,'Fiorentina':4.4,'Bologna':4.1,'Torino':4.6,'default':4.5},
  corners: {'Juventus':6.2,'Inter':7.1,'Milan':6.8,'Napoli':5.9,'Roma':6.5,'Atalanta':8.3,'Lazio':5.7,'Fiorentina':6.4,'Bologna':5.5,'Torino':6.0,'default':5.8},
  gg: {'Juventus':42,'Inter':55,'Milan':62,'Napoli':48,'Roma':58,'Atalanta':68,'Lazio':52,'Fiorentina':60,'Bologna':50,'Torino':54,'default':52}
};

let state = {date: new Date().toISOString().slice(0,10), loading:false, matches:[], selected:null };

function setStatus(msg, type='info') {
  const el = document.getElementById('statusLine');
  el.textContent = msg;
  el.className = `glass p-4 rounded-2xl mt-6 text-sm font-mono text-center ${type==='error' ? 'text-red-400' : 'text-cyan-400 pulse'}`;
}

function cache(key) {
  const item = localStorage.getItem(key);
  if (item) {
    const {t,v} = JSON.parse(item);
    if (Date.now() - t < CACHE_TTL) return v;
  }
  return null;
}
function cacheSet(key, v) { localStorage.setItem(key, JSON.stringify({t:Date.now(),v})); }

async function apiCall(path) {
  if (!RAPIDAPI_KEY) throw 'API Key mancante!';
  const url = `https://${RAPIDAPI_HOST}${path}`;
  const ck = `bb:${btoa(url)}`;
  let data = cache(ck);
  if (data) return data;
  await new Promise(r=>setTimeout(r,MIN_DELAY));
  const res = await fetch(url, {
    headers: {'X-RapidAPI-Key':RAPIDAPI_KEY, 'X-RapidAPI-Host':RAPIDAPI_HOST}
  });
  if (!res.ok) throw `HTTP ${res.status}`;
  data = await res.json();
  cacheSet(ck, data);
  return data;
}

function getStats(team) {
  const lc = team.toLowerCase();
  return {
    cards: FOOTYSTATS.cards[team] || FOOTYSTATS.cards[Object.keys(FOOTYSTATS.cards).find(t=>lc.includes(t.toLowerCase()))] || 4.5,
    corners: FOOTYSTATS.corners[team] || FOOTYSTATS.corners[Object.keys(FOOTYSTATS.corners).find(t=>lc.includes(t.toLowerCase()))] || 5.8,
    gg: FOOTYSTATS.gg[team] || FOOTYSTATS.gg[Object.keys(FOOTYSTATS.gg).find(t=>lc.includes(t.toLowerCase()))] || 52
  };
}

function analyze(home, away) {
  const h = getStats(home), a = getStats(away);
  const totalCorners = (h.corners + a.corners)/2;
  const totalCards = (h.cards + a.cards)/2;
  const ggProb = Math.max(30, Math.min(80, ((h.gg + a.gg)/2 + (totalCorners-9)*2)));
  return {
    gg: {prob: ggProb, pick: ggProb>55 ? 'GG Sì' : 'GG No', conf: 45 + Math.abs(ggProb-50)*1.2},
    corners: {exp: totalCorners, lines: [{line:9.5, pick:totalCorners>9.5?'Over':'Under', conf:50+Math.abs(totalCorners-9.5)*8}, {line:10.5, pick:totalCorners>10.5?'Over':'Under', conf:48+Math.abs(totalCorners-10.5)*7}]},
    cards: {exp: totalCards, lines: [{line:4.5, pick:totalCards>4.5?'Over':'Under', conf:50+Math.abs(totalCards-4.5)*8}, {line:5.5, pick:totalCards>5.5?'Over':'Under', conf:48+Math.abs(totalCards-5.5)*7}]}
  };
}

function confClass(c) { return c>=65 ? 'conf-high neon' : c>=52 ? 'conf-mid neon' : 'conf-low neon'; }

document.getElementById('dateInput').value = state.date;
document.getElementById('dateInput').onchange = e => state.date = e.target.value;
document.getElementById('btnKey').onclick = () => {
  const k = prompt('RapidAPI Key:', RAPIDAPI_KEY);
  if (k) { RAPIDAPI_KEY = k.trim(); localStorage.setItem('RAPIDAPI_KEY', RAPIDAPI_KEY); setStatus('Key salvata!'); }
};
document.getElementById('btnClearCache').onclick = () => { localStorage.clear(); location.reload(); };

async function loadMatches() {
  state.loading = true; state.matches = []; state.selected = null; render(); setStatus('Caricamento...');
  try {
    const data = await apiCall(ENDPOINTS.scheduledEvents('football', state.date));
    state.matches = (data.events || []).map(e => ({
      id: e.id, home: e.homeTeam?.name || e.home?.name || 'Home',
      away: e.awayTeam?.name || e.away?.name || 'Away',
      tournament: e.tournament?.name || '—', startTs: e.startTimestamp || 0
    })).filter(m=>m.id && m.home && m.away);
    setStatus(`${state.matches.length} partite caricate!`);
  } catch(e) { setStatus(e, 'error'); }
  state.loading = false; render();
}
document.getElementById('btnLoad').onclick = loadMatches;

function render() {
  let html = '';
  if (state.loading) {
    html = '<div class="glass p-20 rounded-3xl text-center"><div class="w-20 h-20 border-4 border-cyan-400 border-t-transparent rounded-full loader mx-auto mb-4"></div><div class="text-2xl">Loading...</div></div>';
  } else if (state.selected) {
    const s = state.selected, ana = analyze(s.home, s.away);
    html = `
      <button id="backBtn" class="glass p-4 rounded-2xl mb-6 font-bold flex items-center gap-2 w-fit hover:bg-white/20">
        <i class="fas fa-arrow-left"></i> Lista Partite
      </button>
      <div class="glass p-8 rounded-3xl mb-8 text-center">
        <div class="text-sm text-cyan-400 mb-4">${s.tournament}</div>
        <div class="flex justify-center items-center gap-12 mb-4">
          <div class="text-4xl font-black">${s.home}</div>
          <div class="text-3xl font-bold text-gray-400">VS</div>
          <div class="text-4xl font-black">${s.away}</div>
        </div>
        <div class="text-lg text-gray-400">${new Date(s.startTs*1000).toLocaleString('it-IT', {weekday:'short', day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit'})}</div>
      </div>
      <div class="glass p-8 rounded-3xl mb-8 ${confClass(ana.gg.conf)} text-white shadow-2xl">
        <div class="flex justify-between items-center mb-6">
          <div class="flex items-center gap-4"><i class="fas fa-bullseye text-3xl"></i><h2 class="text-3xl font-black">GG / BTTS</h2></div>
          <div class="text-2xl font-black">${ana.gg.prob.toFixed(0)}%</div>
        </div>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="glass p-8 rounded-3xl text-center ${ana.gg.pick==='GG Sì'?'ring-4 ring-white/50':''}">
            <div class="text-4xl font-black mb-2">GG Sì</div>
            <div class="text-5xl font-black text-emerald-400">${ana.gg.prob.toFixed(0)}%</div>
          </div>
          <div class="glass p-8 rounded-3xl text-center ${ana.gg.pick==='GG No'?'ring-4 ring-white/50':''}">
            <div class="text-4xl font-black mb-2">GG No</div>
            <div class="text-5xl font-black text-red-400">${(100-ana.gg.prob).toFixed(0)}%</div>
          </div>
        </div>
      </div>
      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div class="glass p-6 rounded-3xl">
          <h3 class="text-xl font-bold mb-4 flex items-center gap-2"><i class="fas fa-angle-double-right text-amber-400"></i>Corners (Exp: ${ana.corners.exp.toFixed(1)})</h3>
          ${ana.corners.lines.map(l=>`<div class="flex justify-between p-4 bg-black/30 rounded-2xl mb-2"><span>${l.pick} ${l.line}</span><span class="font-bold ${confClass(l.conf)}">${l.conf.toFixed(0)}%</span></div>`).join('')}
        </div>
        <div class="glass p-6 rounded-3xl">
          <h3 class="text-xl font-bold mb-4 flex items-center gap-2"><i class="fas fa-credit-card text-red-400"></i>Cartellini (Exp: ${ana.cards.exp.toFixed(1)})</h3>
          ${ana.cards.lines.map(l=>`<div class="flex justify-between p-4 bg-black/30 rounded-2xl mb-2"><span>${l.pick} ${l.line}</span><span class="font-bold ${confClass(l.conf)}">${l.conf.toFixed(0)}%</span></div>`).join('')}
        </div>
      </div>`;
  } else {
    html = state.matches.length ? state.matches.map((m,i)=>
      `<div class="glass p-6 rounded-3xl match-card glass-hover cursor-pointer mb-4 transition-all" data-id="${m.id}" style="animation-delay:${i*50}ms">
        <div class="flex justify-between mb-3">
          <div class="text-sm text-cyan-400 font-medium">${m.tournament}</div>
          <div class="text-sm text-gray-500">${new Date(m.startTs*1000).toLocaleTimeString('it-IT',{hour:'2-digit',minute:'2-digit'})}</div>
        </div>
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 glass rounded-xl flex items-center justify-center"></div>
            <div class="font-bold text-xl">${m.home}</div>
          </div>
          <div class="text-2xl font-bold text-gray-500">VS</div>
          <div class="flex items-center gap-3 text-right">
            <div class="font-bold text-xl">${m.away}</div>
            <div class="w-12 h-12 glass rounded-xl flex items-center justify-center"></div>
          </div>
        </div>
        <div class="text-center mt-4 text-emerald-400 font-bold text-sm">Clicca per PRONO</div>
      </div>`).join('') : '<div class="glass p-20 rounded-3xl text-center text-gray-500"><i class="fas fa-inbox text-6xl mb-4 opacity-50"></i><div>Clicca CARICA per partire</div></div>';
  }
  document.getElementById('content').innerHTML = html;
  if (state.selected) document.getElementById('backBtn').onclick = ()=>state.selected=null,render();
  document.querySelectorAll('.match-card')?.forEach(el=>el.onclick=()=> {
    state.selected = state.matches.find(m=>m.id==el.dataset.id);
    render();
  });
}

render();
</script>
</body>
</html>
